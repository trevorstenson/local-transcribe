## Codebase Patterns
- Tauri v2 + React + TypeScript + Tailwind CSS app (macOS desktop)
- Rust backend in src-tauri/src/, React frontend in src/
- Config stored at ~/.local/share/com.dictate.app/config.json (config.rs: load_config/save_config)
- History stored at ~/.local/share/com.dictate.app/history.json (history.rs: load_history/save_history/add_entry)
- Models stored at ~/.local/share/com.dictate.app/models/
- DictationState enum in state.rs uses #[serde(tag = "type")] for discriminated union serialization
- SharedState = Arc<parking_lot::Mutex<AppState>> — use .lock() directly (no .unwrap())
- Tauri commands: #[tauri::command] fn name(...), registered in .invoke_handler(tauri::generate_handler![...])
- Settings UI in ModelSettings.tsx uses toggle pattern: useState + invoke get/set commands + blue/gray pill toggle
- Overlay in Overlay.tsx renders based on DictationState type, returns null for Idle
- Frontend types in src/types.ts must match Rust DictationState enum variants
- Transcription pipeline in lib.rs: Whisper output → trim() → history::add_entry() → paste_text()
- paste_text() in input/paste.rs handles clipboard + Cmd+V simulation + clipboard restore
- regex crate added in US-002 for word-boundary matching
---

## 2026-02-15 - US-001
- Implemented vocabulary storage module in src-tauri/src/vocabulary.rs
- VocabEntry struct (id, phrase, replacement, enabled) and Vocabulary wrapper struct
- CRUD functions: load_vocabulary, save_vocabulary, add_entry, update_entry, delete_entry
- Storage at ~/.local/share/com.dictate.app/vocabulary.json
- Added mod vocabulary to lib.rs
- Files changed: src-tauri/src/vocabulary.rs (new), src-tauri/src/lib.rs
- **Learnings for future iterations:**
  - Follows same pattern as config.rs and history.rs: path function, load with default fallback, save with dir creation
  - default_true() helper already exists in config.rs but vocabulary.rs has its own private copy (different module scope)
  - Dead code warnings are expected until Tauri commands reference the module in later stories
---

## 2026-02-15 - US-002
- Implemented text correction engine with apply_corrections() in vocabulary.rs
- Added regex = "1" dependency to Cargo.toml
- CorrectionApplied struct (original, replacement, position) and CorrectionResult struct (text, corrections)
- apply_corrections() uses regex word boundaries (\b) with case-insensitive matching
- Case preservation: ALL CAPS → uppercased replacement, Title Case → first char uppercased, lowercase → as-is
- Replacements applied from end to start to preserve string positions
- 8 unit tests: basic replacement, word boundary safety, case preservation (3 variants), multiple replacements, disabled entries, empty vocabulary
- Files changed: src-tauri/Cargo.toml, src-tauri/src/vocabulary.rs
- **Learnings for future iterations:**
  - Use (?i) flag in regex for case-insensitive matching combined with \b word boundaries
  - When doing multiple string replacements, apply from end to start to keep positions valid
  - regex::escape() is essential to escape special regex characters in user-provided phrases
  - All 8 tests pass with `cargo test` in project root
---

## 2026-02-15 - US-003
- Added vocab_enabled: bool field to AppConfig in config.rs with #[serde(default = "default_true")]
- Added vocab_enabled: bool field to AppState in state.rs with default true
- Initialized vocab_enabled from config in lib.rs run() setup (same pattern as smart_paste)
- Added get_vocab_enabled and set_vocab_enabled Tauri commands following set_smart_paste pattern
- Registered both commands in invoke_handler generate_handler! macro
- Files changed: src-tauri/src/config.rs, src-tauri/src/state.rs, src-tauri/src/lib.rs
- **Learnings for future iterations:**
  - set_vocab_enabled follows exact same pattern as set_smart_paste: update SharedState lock, then load/mutate/save config
  - The invoke_handler line is getting long — commands listed alphabetically by group makes it easier to find additions
  - default_true() helper exists in config.rs (not exported); vocabulary.rs has its own private copy
---
